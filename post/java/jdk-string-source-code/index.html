<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>初步学习JDK的String类源码 - Hank&#39;s Blog</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Hank" /><meta name="description" content="最近有空看了部分 String 类的源码，下面只挑重点部分记录一下。 为什么要用 final 修饰类 第一个比较特别的就是，String 类是用 final 修饰的，表明这个类不可被继" /><meta name="keywords" content="Machine Learning, Deep Learning, Nodejs, Algorithm, C&#43;&#43;, Docker, NLP, Typescript, Linux, Redis, Mongodb, Leetcode" />






<meta name="generator" content="Hugo 0.54.0 with even 4.0.0" />


<link rel="canonical" href="http://zhengyhn.github.io/post/java/jdk-string-source-code/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<link href="/dist/even.c2a46f00.min.css" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">


<meta property="og:title" content="初步学习JDK的String类源码" />
<meta property="og:description" content="最近有空看了部分 String 类的源码，下面只挑重点部分记录一下。 为什么要用 final 修饰类 第一个比较特别的就是，String 类是用 final 修饰的，表明这个类不可被继" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://zhengyhn.github.io/post/java/jdk-string-source-code/" />
<meta property="article:published_time" content="2019-12-30T00:00:00&#43;00:00"/>
<meta property="article:modified_time" content="2019-12-30T00:00:00&#43;00:00"/>

<meta itemprop="name" content="初步学习JDK的String类源码">
<meta itemprop="description" content="最近有空看了部分 String 类的源码，下面只挑重点部分记录一下。 为什么要用 final 修饰类 第一个比较特别的就是，String 类是用 final 修饰的，表明这个类不可被继">


<meta itemprop="datePublished" content="2019-12-30T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2019-12-30T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="1079">



<meta itemprop="keywords" content="Java,Java8,String,JDK," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="初步学习JDK的String类源码"/>
<meta name="twitter:description" content="最近有空看了部分 String 类的源码，下面只挑重点部分记录一下。 为什么要用 final 修饰类 第一个比较特别的就是，String 类是用 final 修饰的，表明这个类不可被继"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Hank&#39;s blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Hank&#39;s blog</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">初步学习JDK的String类源码</h1>

      <div class="post-meta">
        <span class="post-time"> 2019-12-30 </span>
        <div class="post-category">
            <a href="/categories/java/"> Java </a>
            </div>
          <span class="more-meta"> 约 1079 字 </span>
          <span class="more-meta"> 预计阅读 3 分钟 </span>
        <span id="busuanzi_container_page_pv" class="more-meta"> <span id="busuanzi_value_page_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> 次阅读 </span>
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
<ul>
<li>
<ul>
<li>
<ul>
<li><a href="#为什么要用-final-修饰类">为什么要用 final 修饰类</a></li>
<li><a href="#使用-char-value-存储字符">使用 char value[]存储字符</a></li>
<li><a href="#继承了-serializable-comparable-和-charsequence-接口">继承了 Serializable, Comparable 和 CharSequence 接口</a></li>
<li><a href="#trim-方法到底去掉哪些字符">Trim 方法到底去掉哪些字符？</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
  </div>
</div>
    <div class="post-content">
      

<p>最近有空看了部分 String 类的源码，下面只挑重点部分记录一下。</p>

<h3 id="为什么要用-final-修饰类">为什么要用 final 修饰类</h3>

<p>第一个比较特别的就是，String 类是用 final 修饰的，表明这个类不可被继承。</p>

<pre><code>public final class String
</code></pre>

<p>为什么要防止被继承呢？经过一番研究和思考之后，目前比较靠谱的解析是：String 类是设计成不可变的。假设可以被继承，我们就可以写一个子类继承 String，然后覆盖它的部分方法，使得不可变性遭到破坏。最后，我们把这个子类传给使用方，使用方预期是一个不可变的 String 类，实际得到的是一个可变的子类，这样就出问题了。</p>

<h3 id="使用-char-value-存储字符">使用 char value[]存储字符</h3>

<pre><code>    private final char value[];
</code></pre>

<p>跟预期一样。这里 value 数组定义成 final，表明指向数组的引用一旦赋值，将不能再改变，但是改变了 value 数组在堆上内存的内容，String 的内容还是变了，但是由于它是 private 的，只要 String 的成员方法不修改它的内容，其他类是无法修改它的内容的，这就实现了 String 的不可变特性。​</p>

<h3 id="继承了-serializable-comparable-和-charsequence-接口">继承了 Serializable, Comparable 和 CharSequence 接口</h3>

<p>IO 数据时字符串很常用，继承了 Serializable，就可以序列化成字节和从字节反序列回字符串。</p>

<p>字符串是可以比较的，实现了 Comparable 接口。看了一下实现，有个地方跟我想象中的不一样。</p>

<pre><code>    public int compareTo(String anotherString) {
        int len1 = value.length;
        int len2 = anotherString.value.length;
        int lim = Math.min(len1, len2);
        char v1[] = value;
        char v2[] = anotherString.value;

        int k = 0;
        while (k &lt; lim) {
            char c1 = v1[k];
            char c2 = v2[k];
            if (c1 != c2) {
                return c1 - c2;
            }
            k++;
        }
        return len1 - len2;
    }
</code></pre>

<p>如果某个字符串 A 长度小于另外一个字符串 B，而前面的字符又相等，那是认为 A 小于 B 的。举个例子，&rdquo;abc&rdquo;小于&rdquo;abcd&rdquo;.</p>

<p>看了一下 CharSequence 接口，有下面几个核心方法:</p>

<pre><code>    int length();
    char charAt(int index);
    CharSequence subSequence(int start, int end);
    public String toString();
</code></pre>

<p>阅读 subSequence 方法的时候发现了很多宝藏。</p>

<p>首先 subSequence 很少用，原来 String 类让它直接调用了 substring 方法。</p>

<pre><code>    public CharSequence subSequence(int beginIndex, int endIndex) {
        return this.substring(beginIndex, endIndex);
    }
</code></pre>

<p>在 substring 方法里面，我之前以为不管怎么样一定会返回一个新的 String 对象，其实并不是。当子子字符串就是原字符串时，返回本身，不然才新创建了一个对象。</p>

<pre><code>return ((beginIndex == 0) &amp;&amp; (endIndex == value.length)) ? this
                : new String(value, beginIndex, subLen);
</code></pre>

<p>看到有一些边界检查，会抛出常见的 StringIndexOutOfBoundsException 异常，这里发现，原来每一个异常类都应该要加上 serialVersionUID，因为基类 Throwable 就实现了 Serializable，本意是希望 IO 过程中可以将异常转成字节。</p>

<pre><code>public class Throwable implements Serializable {
    /** use serialVersionUID from JDK 1.0.2 for interoperability */
    private static final long serialVersionUID = -3042686055658047285L;
</code></pre>

<p>这个之前在项目中自定义异常时没有注意到这一点，一直都没加 serialVersionUID.</p>

<p>最后，StringBuilder 和 StringBuffer 也实现了 CharSequence 接口</p>

<h3 id="trim-方法到底去掉哪些字符">Trim 方法到底去掉哪些字符？</h3>

<p>我以为只会去掉空格和 TAB, 回车，换行这些，原来不是这样的，而是 ascii 码表里面小于等于空格的字符都去掉，其实就是不可见字符。</p>

<pre><code>        while ((st &lt; len) &amp;&amp; (val[st] &lt;= ' ')) {
            st++;
        }
        while ((st &lt; len) &amp;&amp; (val[len - 1] &lt;= ' ')) {
            len--;
        }
        return ((st &gt; 0) || (len &lt; value.length)) ? substring(st, len) : this;
</code></pre>

<p>附一张 ascii 码表:
<img src="/images/asciifull.gif" alt="ascii" title="ascii" /></p>

<p>先学习这么多, 更深入的内容，下次再看。</p>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">Hank</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
        2019-12-30
        
    </span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">许可协议</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a></span>
  </p>
</div>
<div class="post-reward">
  <input type="checkbox" name="reward" id="reward" hidden />
  <label class="reward-button" for="reward">赞赏支持</label>
  <div class="qr-code">
    
    <label class="qr-code-image" for="reward">
        <img class="image" src="/images/wechat.jpg">
        <span>微信打赏</span>
      </label>
    <label class="qr-code-image" for="reward">
        <img class="image" src="/images/alipay.jpg">
        <span>支付宝打赏</span>
      </label>
  </div>
</div><footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/java/">Java</a>
          <a href="/tags/java8/">Java8</a>
          <a href="/tags/string/">String</a>
          <a href="/tags/jdk/">JDK</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/java/jdk-enum-source-code/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">初步学习JDK的Enum类源码</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        <a class="next" href="/post/react/react-tic-tac-toe/">
            <span class="next-text nav-default">React入门-井字游戏实现与完善</span>
            <span class="next-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        <div id="comments-gitment"></div>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/theme-next/theme-next-gitment@1/default.min.css" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/gh/theme-next/theme-next-gitment@1/gitment.browser.min.js" crossorigin="anonymous"></script>
    <script type="text/javascript">
      var gitment = new Gitment({
        id: '2019-12-30 00:00:00 \x2b0000 UTC',
        title: '初步学习JDK的String类源码',
        link: decodeURI(location.href),
        desc: '最近有空看了部分 String 类的源码，下面只挑重点部分记录一下。 为什么要用 final 修饰类 第一个比较特别的就是，String 类是用 final 修饰的，表明这个类不可被继',
        owner: 'zhengyhn',
        repo: 'zhengyhn.github.io',
        oauth: {
          client_id: '3906b3202777c482f061',
          client_secret: 'fcbbda8eb9ee72273744d940ebeaab90486c8e4b'
        }
      });
      gitment.render('comments-gitment');
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://github.com/imsun/gitment">comments powered by gitment.</a></noscript>

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:yuanhang.zheng@qq.com" class="iconfont icon-email" title="email"></a>
      <a href="https://github.com/zhengyhn" class="iconfont icon-github" title="github"></a>
  <a href="http://zhengyhn.github.io/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  <div class="busuanzi-footer">
    <span id="busuanzi_container_site_pv"> 本站总访问量 <span id="busuanzi_value_site_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> 次 </span>
      <span class="division">|</span>
    <span id="busuanzi_container_site_uv"> 本站总访客数 <span id="busuanzi_value_site_uv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> 人 </span>
  </div>

  <span class="copyright-year">
    &copy; 
    2017 - 
    2020
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">Hank</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script><script></script><script src="/lib/flowchartDiagrams/raphael-2.2.7.min.js" integrity="sha256-67By+NpOtm9ka1R6xpUefeGOY8kWWHHRAKlvaTJ7ONI=" crossorigin="anonymous"></script>
    <script src="/lib/flowchartDiagrams/flowchart-1.8.0.min.js" integrity="sha256-zNGWjubXoY6rb5MnmpBNefO0RgoVYfle9p0tvOQM+6k=" crossorigin="anonymous"></script><script></script><script src="/lib/js-sequence-diagrams/webfontloader-1.6.28.js" integrity="sha256-4O4pS1SH31ZqrSO2A/2QJTVjTPqVe+jnYgOWUVr7EEc=" crossorigin="anonymous"></script>
    <script src="/lib/js-sequence-diagrams/snap.svg-0.5.1.min.js" integrity="sha256-oI+elz+sIm+jpn8F/qEspKoKveTc5uKeFHNNVexe6d8=" crossorigin="anonymous"></script>
    <script src="/lib/js-sequence-diagrams/underscore-1.8.3.min.js" integrity="sha256-obZACiHd7gkOk9iIL/pimWMTJ4W/pBsKu+oZnSeBIek=" crossorigin="anonymous"></script>
    <script src="/lib/js-sequence-diagrams/sequence-diagram-2.0.1.min.js" integrity="sha384-8748Vn52gHJYJI0XEuPB2QlPVNUkJlJn9tHqKec6J3q2r9l8fvRxrgn/E5ZHV0sP" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="/lib/js-sequence-diagrams/sequence-diagram-2.0.1.min.css" integrity="sha384-6QbLKJMz5dS3adWSeINZe74uSydBGFbnzaAYmp+tKyq60S7H2p6V7g1TysM5lAaF" crossorigin="anonymous">
<script type="text/javascript" src="/dist/even.26188efa.min.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]},
      TeX: {equationNumbers: {autoNumber: "AMS"}},
      showProcessingMessages: false,
      messageStyle: 'none'
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"  integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>








</body>
</html>
