<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Postponing definitions instead of preponing - Hank&#39;s Blog</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Hank" />
  <meta name="description" content="Prepone definitions? Wrong! Before C99, you must prepone all the variables&amp;rsquo; definitions before any statements. But after C99 was released, you can put a variable&amp;rsquo;s definition in any place as long as before being used. I think this new feature is introduced by learning from C&#43;&#43;.
This makes programer write codes more convenient. But I used to insist the old style. I even teach my students that they should use the old style when I was a TA of the course Programming with C." />

  <meta name="keywords" content="Machine Learning, Deep Learning, Nodejs, Algorithm, C&#43;&#43;, Docker, NLP, Typescript, Linux, Redis, Mongodb, Leetcode" />






<meta name="generator" content="Hugo 0.37.1" />


<link rel="canonical" href="http://zhengyhn.github.io/post/cpp/2013-08-11-postponing-definitions-instead-of-preponing/" />

<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">




<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>


<link href="/dist/even.min.css?v=3.1.1" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">




<meta property="og:title" content="Postponing definitions instead of preponing" />
<meta property="og:description" content="Prepone definitions? Wrong! Before C99, you must prepone all the variables&rsquo; definitions before any statements. But after C99 was released, you can put a variable&rsquo;s definition in any place as long as before being used. I think this new feature is introduced by learning from C&#43;&#43;.
This makes programer write codes more convenient. But I used to insist the old style. I even teach my students that they should use the old style when I was a TA of the course Programming with C." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://zhengyhn.github.io/post/cpp/2013-08-11-postponing-definitions-instead-of-preponing/" />



<meta property="article:published_time" content="2016-05-14T16:35:19&#43;08:00"/>

<meta property="article:modified_time" content="2016-05-14T16:35:19&#43;08:00"/>











<meta itemprop="name" content="Postponing definitions instead of preponing">
<meta itemprop="description" content="Prepone definitions? Wrong! Before C99, you must prepone all the variables&rsquo; definitions before any statements. But after C99 was released, you can put a variable&rsquo;s definition in any place as long as before being used. I think this new feature is introduced by learning from C&#43;&#43;.
This makes programer write codes more convenient. But I used to insist the old style. I even teach my students that they should use the old style when I was a TA of the course Programming with C.">


<meta itemprop="datePublished" content="2016-05-14T16:35:19&#43;08:00" />
<meta itemprop="dateModified" content="2016-05-14T16:35:19&#43;08:00" />
<meta itemprop="wordCount" content="605">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Postponing definitions instead of preponing"/>
<meta name="twitter:description" content="Prepone definitions? Wrong! Before C99, you must prepone all the variables&rsquo; definitions before any statements. But after C99 was released, you can put a variable&rsquo;s definition in any place as long as before being used. I think this new feature is introduced by learning from C&#43;&#43;.
This makes programer write codes more convenient. But I used to insist the old style. I even teach my students that they should use the old style when I was a TA of the course Programming with C."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Hank&#39;s blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Hank&#39;s blog</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Postponing definitions instead of preponing</h1>

      <div class="post-meta">
        <span class="post-time"> 2016-05-14 </span>
        
        <span class="more-meta"> 约 605 字 </span>
        <span class="more-meta"> 预计阅读 3 分钟 </span>
        <span id="busuanzi_container_page_pv" class="more-meta"> <span id="busuanzi_value_page_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> 次阅读 </span>
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  
  <div class="post-toc-content">
    <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#prepone-definitions-wrong">Prepone definitions? Wrong!</a></li>
<li><a href="#define-and-then-assign-wrong">Define and then assign? Wrong!</a></li>
</ul></li>
</ul>
</nav>
  </div>
</div>

    
    

    
    <div class="post-content">
      

<h2 id="prepone-definitions-wrong">Prepone definitions? Wrong!</h2>

<p>Before C99, you must prepone all the variables&rsquo; definitions before any
statements. But after C99 was released, you can put a variable&rsquo;s definition
in any place as long as before being used. I think this new feature is
introduced by learning from C++.</p>

<p>This makes programer write codes more convenient. But I used to insist the
old style. I even teach my students that they should use the old style when
I was a TA of the course <em>Programming with C</em>.</p>

<p>However, now I realize that I was wrong. <strong>We should postpone variables&rsquo;</strong>
<strong>definitions as long as possible</strong>. It&rsquo;s not for coding style, but for the
effeciency of the program.</p>

<p>Consider this program.</p>

<pre><code>#include &lt;cstdio&gt;
#include &lt;iostream&gt;

void
save_pwd(const std::string&amp; pwd)
{
    std::string salted_pwd(&quot;abc&quot;);

    if (pwd.size() &lt; 6) {
        fprintf(stderr, &quot;Password too short.&quot;);
        return;
    }
    salted_pwd += pwd;
    ...
}

int
main(int argc, char **argv)
{
    save_pwd(&quot;ddd&quot;);

    return 0;
}
</code></pre>

<p>When running this program, it will print an error and exit the function.
The variable <code>salted_pwd</code> is not used. So, defining <code>salted_pwd</code> above
the <code>if</code> statement will waste the memory, the time to allocate memory and
the time to free memory. For the view of C++, you will pay for the cost of
construction and destruction of the object <code>salted_pwd</code>.</p>

<h2 id="define-and-then-assign-wrong">Define and then assign? Wrong!</h2>

<p>When I first learned programming in C, my teacher says that</p>

<pre><code>int a;
a = 1;
</code></pre>

<p>is the same as</p>

<pre><code>int a = 1;
</code></pre>

<p>Now I realize that they are not the same and the latter is more effecient.</p>

<p>For the former, <code>int a;</code> will allocate memory for the variable <code>a</code> and
then fill zero bytes in the memory. Then <code>a = 1;</code> will write value <code>1</code>
in the memory.
For the latter, <code>int a = 1;</code> will directly allocate memory for the variable
<code>a</code> and then write value <code>1</code> in the memory.
In other words, you will pay more cost when using the former style.</p>

<p>It seems that it makes little difference with the built-in type. When the
type of the variable <code>a</code> is user-defined type, great difference appears.</p>

<p>For example,</p>

<pre><code>std::string str;
...
std::string = &quot;abc&quot;;
</code></pre>

<p>This will first call the default constructor of <code>std::string</code> and then call
the copy assignment operator. So the time and memory used in the default
constructor is wasted.</p>

<p>If we define an object in this way</p>

<pre><code>std::string str(&quot;abc&quot;);
</code></pre>

<p>or</p>

<pre><code>std::string str = &quot;abc&quot;;
</code></pre>

<p>, it will only call the copy constructor. This is more effecient.</p>

<p>So now I prefer this way</p>

<pre><code>for (int i = 0; i &lt; n; i++) {
    ...
}
</code></pre>

<p>instead of</p>

<pre><code>int i;

for (i = 0; i &lt; n; i++) {
    ...
}
</code></pre>

<p>Now there is a special case that is worth thinking.</p>

<pre><code>Person p;
for (int i = 0; i &lt; n; i++) {
    p = persons[i];
    ...
}
</code></pre>

<p>and</p>

<pre><code>for (int i = 0; i &lt; n; i++) {
    Person p = persons[i];
    ...
}
</code></pre>

<p>, which is better?</p>

<p>Let&rsquo;s analysis the performance of them.
* The former need 1 construction, n assignments and 1 destruction. But it makes
the object <code>p</code> in a larger scope, which increase the comprehensibility and
maintainability of the program.
* The latter need n constructions and n destructions.</p>

<p>Which is more effecient? I think it all depends. If assignment is less expensive
than the total of construction and destruction, we should use the former style.
On the contray, we should use the latter style.</p>

<p>The author of <strong>Effective C++</strong> prefers the latter, but I prefer the former,
since I am sensitive with performance and I think memory allocation and free
will be more expensive than assignment.</p>

    </div>

    
    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">Hank</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">2016-05-14</span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">许可协议</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a></span>
  </p>
</div>

    
    
<div class="post-reward">
  <input type="checkbox" name="reward" id="reward" hidden />
  <label class="reward-button" for="reward">赞赏支持</label>
  <div class="qr-code">
    
    
      <label class="qr-code-image" for="reward">
        <img class="image" src="/images/wechat.jpg">
        <span>微信打赏</span>
      </label>
    
      <label class="qr-code-image" for="reward">
        <img class="image" src="/images/alipay.jpg">
        <span>支付宝打赏</span>
      </label>
  </div>
</div>

    <footer class="post-footer">
      

      
      <nav class="post-nav">
        
          <a class="prev" href="/post/cpp/2013-09-25-my-c-plus-plus-coding-style/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">My C&#43;&#43; coding style</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        
          <a class="next" href="/post/2013-06-30-ruby-getting-started/">
            <span class="next-text nav-default">Ruby-getting started</span>
            <span class="next-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        
  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:yuanhang.zheng@qq.com" class="iconfont icon-email" title="email"></a>
      <a href="https://github.com/zhengyhn" class="iconfont icon-github" title="github"></a>
  <a href="http://zhengyhn.github.io/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  <div class="busuanzi-footer">
    <span id="busuanzi_container_site_pv"> 本站总访问量 <span id="busuanzi_value_site_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> 次 </span>
    <span class="division">|</span>
    <span id="busuanzi_container_site_uv"> 本站总访客数 <span id="busuanzi_value_site_uv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> 人 </span>
  </div>

  <span class="copyright-year">
    &copy; 
    
      2017 - 
    2018
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">Hank</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
<script src="/lib/highlight/highlight.pack.js?v=20171001"></script><script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>

<script></script>
<script src="https://cdn.jsdelivr.net/npm/raphael@2.2.7/raphael.min.js" integrity="sha256-67By+NpOtm9ka1R6xpUefeGOY8kWWHHRAKlvaTJ7ONI=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/flowchart.js@1.8.0/release/flowchart.min.js" integrity="sha256-zNGWjubXoY6rb5MnmpBNefO0RgoVYfle9p0tvOQM+6k=" crossorigin="anonymous"></script><script></script>
<script src="https://cdn.jsdelivr.net/npm/webfontloader@1.6.28/webfontloader.js" integrity="sha256-4O4pS1SH31ZqrSO2A/2QJTVjTPqVe+jnYgOWUVr7EEc=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/snapsvg@0.5.1/dist/snap.svg-min.js" integrity="sha256-oI+elz+sIm+jpn8F/qEspKoKveTc5uKeFHNNVexe6d8=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/underscore@1.8.3/underscore-min.js" integrity="sha256-obZACiHd7gkOk9iIL/pimWMTJ4W/pBsKu+oZnSeBIek=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/gh/bramp/js-sequence-diagrams@2.0.1/dist/sequence-diagram-min.js" integrity="sha384-8748Vn52gHJYJI0XEuPB2QlPVNUkJlJn9tHqKec6J3q2r9l8fvRxrgn/E5ZHV0sP" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/bramp/js-sequence-diagrams@2.0.1/dist/sequence-diagram-min.css" integrity="sha384-6QbLKJMz5dS3adWSeINZe74uSydBGFbnzaAYmp+tKyq60S7H2p6V7g1TysM5lAaF" crossorigin="anonymous">
<script type="text/javascript" src="/dist/even.min.js?v=3.1.1"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]},
      TeX: {equationNumbers: {autoNumber: "AMS"}},
      showProcessingMessages: false,
      messageStyle: 'none'
    };
  </script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML"></script>








</body>
</html>
